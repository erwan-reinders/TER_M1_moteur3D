<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>


    <script type="text/javascript" src="../v0/src/JS/trackball-rotator.js" ></script>
    <script type="text/javascript" src="../v0/src/JS/lib/gl-matrix-min.js" ></script>
    <script type="text/javascript" src="data/meshes/basic-object-models-IFS.js" ></script>
    <script type="text/javascript" src="data/meshes/teapot-model-IFS.js" ></script>

    <script type="text/javascript" src="js/util.js" ></script>
    <script type="text/javascript" src="js/texture.js" ></script>
    <script type="text/javascript" src="js/model.js" ></script>
    <script type="text/javascript" src="js/camera.js" ></script>
    <script type="text/javascript" src="js/Light.js" ></script>
    <script type="text/javascript" src="js/scene.js"></script>
</head>
<body>

    <div id="canvas-holder">
        <canvas width=1200 height=600 id="webglcanvas" style="background-color:white"></canvas>
    </div>

    <script id="vs" type="x-shader/x-vertex">#version 300 es
        precision highp float;
        layout (location=0) in vec3 aVertexPosition;
        layout (location=1) in vec3 aVertexNormal;
        layout (location=2) in vec2 aVertexUV;

        uniform mat4 uNormalMatrix;
        uniform mat4 uViewMatrix;
        uniform mat4 uModelMatrix;
        uniform mat4 uProjectionMatrix;

        out vec3 vNormal;
        out vec3 vFragPos;
        out vec2 vFragUV;

        void main(void) {
            vFragPos = vec3(uModelMatrix * vec4(aVertexPosition, 1.0));
            vNormal = vec3(uNormalMatrix * vec4(aVertexNormal, 1.0));
            vFragUV = aVertexUV;

            gl_Position = uProjectionMatrix * uViewMatrix * vec4(vFragPos, 1.0);
        }
    </script>
    <script id="fs" type="x-shader/x-fragment">#version 300 es
        precision highp float;
        // Fragment-Interpolated data
        in vec3 vNormal;
        in vec3 vFragPos;
        in vec2 vFragUV;

        // Camera
        uniform vec3 uViewPos;
        // Light
        uniform vec3 uLightPos;
        uniform vec3 uLightColor;

        // Material
        uniform vec3 uObjectColor;
        uniform float uShininess;
        // uniform sampler2D uSampler;// texture

        out vec4 FragColor;

        void main(void) {
            // highp vec4 texelColor = texture2D(uSampler, vTextureCoord);

            // ambient
            float ambientStrength = 0.1;
            vec3 ambient = ambientStrength * uLightColor;

            // diffuse
            vec3 norm = normalize(vNormal);
            vec3 lightDir = normalize(uLightPos - vFragPos);
            float diff = max(dot(norm, lightDir), 0.0);
            vec3 diffuse = diff * uLightColor;

            // specular
            float specularStrength = uShininess;
            vec3 viewDir = normalize(uViewPos - vFragPos);
            vec3 reflectDir = reflect(-lightDir, norm);
            float spec = max(dot(viewDir, reflectDir), 0.0);
            vec3 specular = specularStrength * spec * uLightColor;

            vec3 result = (ambient + diffuse + specular) * uObjectColor;
            FragColor = vec4(result, 1.0);
        }
    </script>

    <script type="text/javascript" defer>
        let scene;
        function main() {
            initGl("webglcanvas");
            scene = new Scene("webglcanvas");
            scene.addModel(new Model(cube(), null, "vs", "fs", gl.drawingBufferHeight, gl.drawingBufferWidth));
            scene.initModels();
            frame();

            document.addEventListener('keydown', onKey);
            document.addEventListener('mousemove', onMousemove);
            document.addEventListener('mousedown', onClick);
        }

        function onKey(event) {
            console.log(event);
            if (event.key == "ArrowRight") {
                vec3.add(scene.current_camera.position, scene.current_camera.position, vec3.clone([0.1, 0.0, 0.0]));
            }
            frame();
        }

        function onMousemove(event) {
            //console.log(event);
        }

        function onClick(event) {
            console.log(event);
        }

        function frame() {
            scene.render();
        }

        window.onload = main;
    </script>
</body>
</html>